{% extends 'base.html.twig' %}

{% block title %}Contact Support - BlogSphere{% endblock %}

{% block stylesheets %}
<link rel="stylesheet" href="{{ asset('css/contact.css') }}">
{% endblock %}

{% block body %}
<div class="support-container">
    <div class="support-header">
        <h1>üí¨ Support Client</h1>
        <p>Communiquez directement avec nos superviseurs et administrateurs pour toute question ou probl√®me.</p>
    </div>

    {% for message in app.flashes('success') %}
        <div class="alert alert-success">
            {{ message }}
        </div>
    {% endfor %}

    {% for message in app.flashes('error') %}
        <div class="alert alert-error">
            {{ message }}
        </div>
    {% endfor %}

    <div class="support-layout {% if isStaffMember %}full-width{% endif %}">
        {% if not isStaffMember %}
        <div class="support-form-section">
            <h3>Envoyer un Message</h3>
            <form method="POST" class="support-form">
                <div class="form-group">
                    <label for="subject">Sujet *</label>
                    <input type="text" id="subject" name="subject" placeholder="Ex: Question sur mon compte" required>
                </div>

                <div class="form-group">
                    <label for="type">Type de Demande *</label>
                    <select id="type" name="type" required>
                        <option value="">-- S√©lectionnez --</option>
                        <option value="question">Question</option>
                        <option value="problem">Probl√®me/Bug</option>
                        <option value="other">Autre</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="message">Message *</label>
                    <textarea id="message" name="message" placeholder="D√©crivez votre question ou probl√®me en d√©tail..." required></textarea>
                </div>

                <button type="submit" class="btn">Envoyer</button>
            </form>
        </div>
        {% endif %}

        <div class="conversations-section">
            <div class="conversations-header">
                <h2>Vos Conversations</h2>
            </div>
            <div class="conversations-list">
                {% if conversations|length > 0 %}
                    {% for conversation in conversations %}
                        <div class="conversation-item">
                            <a href="{{ path('app_contact_support_conversation', {id: conversation.id}) }}">
                                <div class="conversation-subject">{{ conversation.subject }}</div>
                                <div class="conversation-preview">{{ conversation.content|slice(0, 100) }}{% if conversation.content|length > 100 %}...{% endif %}</div>
                                <div class="conversation-meta">
                                    <span class="message-type-badge type-{{ conversation.messageType }}">
                                        {% if conversation.messageType == 'question' %}
                                            ‚ùì Question
                                        {% elseif conversation.messageType == 'problem' %}
                                            ‚ö†Ô∏è Probl√®me
                                        {% else %}
                                            üìå Autre
                                        {% endif %}
                                    </span>
                                    <span>{{ conversation.createdAt|date('d/m/Y H:i') }}</span>
                                </div>
                            </a>
                        </div>
                    {% endfor %}
                {% else %}
                    <div class="empty-state">
                        <p>Aucune conversation pour le moment.</p>
                        <p style="font-size: 0.95rem;">Envoyez un message ci-contre pour commencer une conversation avec notre √©quipe.</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
