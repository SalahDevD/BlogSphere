{% extends 'base.html.twig' %}

{% block title %}{{ article.title }}{% endblock %}

{% block body %}
<div style="background: #f9fafb; min-height: 100vh; padding: 3rem 0;">
    <div style="max-width: 900px; margin: 0 auto; padding: 0 2rem;">
        <a href="{{ path('app_article_index') }}" style="display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.5rem 1rem; background: #e5e7eb; color: #374151; text-decoration: none; border-radius: 8px; font-weight: 600; margin-bottom: 2rem; transition: all 0.3s;">‚Üê Tous les articles</a>

        <div style="background: white; padding: 2rem; border-radius: 12px; margin-bottom: 2rem; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
            {% if article.category %}
                <span style="display: inline-block; padding: 0.35rem 0.85rem; background: #FFE5DC; color: #FF6B35; border-radius: 20px; font-size: 0.85rem; font-weight: 600; margin-bottom: 1rem;">{{ article.category.name }}</span>
            {% endif %}

            <h1 style="font-size: 2.5rem; font-weight: 900; color: #111827; margin-bottom: 1.5rem; line-height: 1.3;">{{ article.title }}</h1>

            <div style="display: flex; gap: 2rem; padding-bottom: 1rem; border-bottom: 2px solid #e5e7eb; margin-bottom: 1rem; flex-wrap: wrap;">
                <div>
                    <p style="font-size: 0.85rem; color: #6b5563; font-weight: 600; text-transform: uppercase;">AUTEUR</p>
                    <p style="font-size: 1rem; color: #111827; font-weight: 600;">{{ article.author.name }}</p>
                </div>
                <div>
                    <p style="font-size: 0.85rem; color: #6b5563; font-weight: 600; text-transform: uppercase;">DATE</p>
                    <p style="font-size: 1rem; color: #111827; font-weight: 600;">{{ article.createdAt|date('d M Y H:i') }}</p>
                </div>
            </div>

            {% if is_granted('ROLE_USER') and article.author == app.user %}
                <div style="display: flex; gap: 1rem;">
                    <a href="{{ path('app_article_edit', {id: article.id}) }}" style="padding: 0.5rem 1rem; background: #667eea; color: white; text-decoration: none; border-radius: 8px; font-weight: 600;">‚úèÔ∏è Modifier</a>
                    <form method="POST" action="{{ path('app_article_delete', {id: article.id}) }}" style="display: inline; margin: 0;">
                        <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ article.id) }}">
                        <button type="submit" onclick="return confirm('Supprimer ?')" style="padding: 0.5rem 1rem; background: #ef4444; color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">üóëÔ∏è Supprimer</button>
                    </form>
                </div>
            {% endif %}
        </div>

        {% if article.image %}
            <img src="{{ asset('uploads/articles/' ~ article.image) }}" alt="{{ article.title }}" style="width: 100%; max-height: 500px; object-fit: cover; border-radius: 12px; margin-bottom: 2rem; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
        {% endif %}

        <div style="background: white; padding: 2rem; border-radius: 12px; margin-bottom: 2rem; font-size: 1.1rem; color: #374151; line-height: 1.8; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
            {{ article.content|nl2br|raw }}
        </div>

        <div style="background: white; padding: 2rem; border-radius: 12px; margin-bottom: 2rem; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
            <h3 style="font-size: 1.25rem; font-weight: 700; color: #111827; margin-bottom: 1.5rem;">Votre avis</h3>
            
            {% if is_granted('ROLE_USER') %}
                <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                    {# üëç Like article #}
                    <form method="POST"
                          action="{{ path('reaction_article_like', { articleId: article.id }) }}"
                          style="display: inline;">
                        <button type="submit"
                                style="padding: 0.75rem 1.5rem; background: white; border: 2px solid #e5e7eb; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s; color: #374151;">
                            üëç J'aime
                        </button>
                    </form>

                    {# üëé Dislike article (optionnel) #}
                    {#
                    <form method="POST"
                          action="{{ path('reaction_article_dislike', { articleId: article.id }) }}"
                          style="display: inline;">
                        <button type="submit"
                                style="padding: 0.75rem 1.5rem; background: white; border: 2px solid #e5e7eb; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s; color: #374151;">
                            üëé Je n'aime pas
                        </button>
                    </form>
                    #}
                </div>
            {% else %}
                <p style="background: #FFE5DC; padding: 1rem; border-radius: 8px; border-left: 4px solid #FF6B35; color: #111827;">
                    üë§ <a href="{{ path('app_login') }}" style="color: #FF6B35; font-weight: 600; text-decoration: none;">Connectez-vous</a> pour r√©agir
                </p>
            {% endif %}
        </div>

        <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
            <h3 style="font-size: 1.25rem; font-weight: 700; color: #111827; margin-bottom: 1.5rem;">üí¨ Commentaires ({{ article.comments|length }})</h3>
            
            {% if is_granted('ROLE_USER') %}
                <form method="POST" action="{{ path('app_comment_add', {id: article.id}) }}" style="margin-bottom: 2rem;">
                    <textarea name="content" style="width: 100%; padding: 1rem; border: 2px solid #e5e7eb; border-radius: 8px; min-height: 120px; margin-bottom: 1rem; font-family: inherit; font-size: 1rem;" placeholder="Votre commentaire..." required></textarea>
                    <button type="submit" style="padding: 0.75rem 1.5rem; background: linear-gradient(135deg, #FF6B35, #E85A2A); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 700; transition: all 0.3s;">Publier</button>
                </form>
            {% endif %}

            {% if article.comments|length > 0 %}
                <div style="display: flex; flex-direction: column; gap: 1rem;">
                {% for comment in article.comments %}
                    {% if comment.status == 'approved' %}
                        <div style="background: #f9fafb; padding: 1.5rem; border-radius: 8px; border-left: 4px solid #FF6B35;">
                            <strong style="color: #111827; display: block; margin-bottom: 0.5rem; font-size: 1rem;">{{ comment.author.name }}</strong>
                            <small style="color: #6b5563; display: block; margin-bottom: 1rem; font-size: 0.85rem;">{{ comment.createdAt|date('d M Y H:i') }}</small>
                            <p style="color: #374151; line-height: 1.6; margin: 0;">{{ comment.content|nl2br }}</p>
                        </div>
                    {% endif %}
                {% endfor %}
                </div>
            {% else %}
                <p style="text-align: center; color: #6b5563; padding: 2rem;">Aucun commentaire. Soyez le premier !</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
